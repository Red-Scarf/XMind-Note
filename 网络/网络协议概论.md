# 网络协议层次
![网络层次](\img\InternetLayers.png)

当前互联网的网络层次大致分为五层。

# 物理层
普通的网线，传输二进制信号。

# 数据链路层
定义在实体层上方，确定了二进制信号的分组方式。

## 以太网
> 建立机器到机器之间的通信
![以太网](\img\1-1.png)

一组二进制信号组成一个数据包，叫做"帧"（Frame）。每一帧分成两个部分：标头（Head）和数据（Data）。

"标头"包含数据包的一些说明项，比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。

"标头"的长度，固定为 18 字节。"数据"的长度，最短为 46 字节，最长为 1500 字节。因此，整个"帧"最短为 64 字节，最长为 1518 字节。如果数据很长，就必须分割成多个帧进行发送。

## MAC 地址
以太网规定数据使用网卡进行传输，每块网卡都有自己独一无二的 MAC 地址。长度是48个二进制位，通常用12个十六进制数表示。前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。

# 网络层

> 建立"主机到主机"的通信。

所有的计算机处于一个个不用的子网内部，需要通过IP地址标识计算机所处的子网环境。

目前广泛采用的是IP协议第四版，简称IPv4。这个版本规定，网络地址由32个二进制位组成。用分成四段的十进制数表示IP地址，从0.0.0.0一直到255.255.255.255。

IP 地址表明该计算机所处的子网以及在子网内部的地址。需要配合子网掩码才能知道所处子网。

![以太网](\img\1-2.png)

"标头"部分主要包括版本、长度、IP地址等信息，"数据"部分则是IP数据包的具体内容。它放进以太网数据包后，以太网数据包就变成了下面这样。

![以太网](\img\1-3.png)

IP 数据包的"标头"部分的长度为 20 到 60 字节，整个数据包的总长度最大为 65535 字节。如果IP数据包超过了 1500 字节，它就需要分割成几个以太网数据包分开发送。

# 传输层
> 建立"端口到端口"的通信。

系统层级用来区分不同应用所使用的网络连接的标志，即"端口"，本质是每一个使用网卡的程序的编号。

"端口"是 0 到 65535 之间的一个整数，正好 16 个二进制位。0 到 1023 的端口被系统占用，用户只能选用大于 1023 的端口。

传输层使用 TCP/UPD 协议，结构类似。

![以太网](\img\1-4.png)

"标头"部分主要定义了发出端口和接收端口，"数据"部分就是具体的内容。放入 IP 数据包中再嵌入以太网数据包后，成如下形式。

![以太网](\img\1-5.png)

UDP 数据包非常简单，"标头"部分一共只有 8 个字节，总长度不超过 65535 字节，正好放进一个 IP 数据包。

TCP 整个包的最大长度是由最大传输大小(MSS，Maxitum Segment Size)决定，MSS就是TCP数据包每次能够传输的最大数据分段。这个值在实现的时候往往用 MTU 值代替（需要减去IP数据包包头的大小 20Bytes 和 TCP 数据段的包头 20Bytes）所以往往 MSS 为 1460。

对于一个以太网来说，TCP的最大报文段长度即MSS一般是1460字节（1500(MTU) - 20(IP head) - 20(TCP head) = 1460 Byte），减去12字节的TCP timestamp option，留给TCP正文数据是 1448字节 。

# 应用层
> 规定应用程序的数据格式

![以太网](\img\1-6.png)

**典型的应用层协议就是 HTTP**